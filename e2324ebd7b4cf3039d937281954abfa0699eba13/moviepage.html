<!DOCTYPE html>
<html>
    <head>
        <title>Movie Page</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
        <!--IMPORT CSS-->
        <link rel="stylesheet" href="css/index.css">
        <!--IMPORT JAVASCRIPT & JQUERY-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script src="js/script.js" async></script>
        <script src="html/imports.js" async></script>
    </head>
    <body>
        <aside>stored in html/imports.html</aside>
        <div class="main-container">
            <header>stored in html/imports.html</header>
            <nav> <!-- button tag uses javascript to use the href -->
                <button onclick="changeHash(-1);" type="button">Previous</button>
                <button onclick="location.href = 'index.html'" type="button">Home</button>
                <button onclick="changeHash(1);" type="button">Next</button>
            </nav>
            <div class="dynamic">
                <picture class="background"></picture>
                <section class="title">
                    <h2><b>###</b></h2>
                </section>
                <section class="image-container">
                    <img alt="Poster">
                </section>
                <section> 
                    <article class="description">
                        <b>###</b>
                    </article>
                </section> 
                <section class="booking">
                    <h4><button id="bookbutton" onclick="showForm()">BOOK NOW!</button></h4>
                    <!-- as soon as the form is submitted it will pass the input to the php file, then it will run the js function-->
                    <form name="booking" method="post" action="php/post2sql.php" onsubmit="return bookingValidation()">
                        <input type="text" placeholder="Your Name" name="name" required>
                        <input type="text" placeholder="Your Email" name="email" required>
                        <input id="date" type="date" name="date" required>
                        <button type="submit">Book</button>
                        <div>
                            Thanks for booking with us, Thanks for booking with us, Thanks for booking with us, Thanks for booking with us, Thanks for booking with us
                        </div>
                    </form>
                </section>
                <section class="video">
                    <div class="iframe-container">
                        <!-- interaction with youtube api is made through the url -->
                        <iframe
                            src="###" allowfullscreen>
                        </iframe>
                        <div>
                            </section>
                        </div>
                        <footer>stored in html/imports.html</footer>
                    </div>
                    <script>
                        /*
                         */
                        onload = function () {
                            changeContent();
                        };
                        onhashchange = function () {
                            changeContent();
                        };
                        /*
                         */
                        function changeContent() {
                            moviepageXml('.title h2 b', 'mtitle');
                            moviepageXml('.description b', 'description');
                            moviepageXml('.background', 'image');
                            moviepageXml('.image-container img', 'image');
                            moviepageXml('.iframe-container iframe', 'video');
                        }

                        function moviepageXml(selector, tag) {
                            $.ajax({// see specification on https://api.jquery.com/jquery.ajax/
                                url: 'xml/movielist2.xml',
                                success: function (xml) {
                                    /* start asyncronous call */
                                    var id = +location.hash.substring(1);
                                    var content = $(xml).find(tag).eq(id - 1).text();
                                    var sel = $(selector);
                                    if (sel.is('.background')){
                                        sel.css('background-image','url('+content+')');
                                    } else if (sel.is('img')) {
                                        sel.attr("src", content);
                                    } else if (sel.is('iframe')) {
                                        sel.attr("src", content + "?autoplay=1&mute=1&modestbranding=1&iv_load_policy=3");
                                    } else {
                                        sel.html(content);
                                    }
                                    /* end asyncronous call */
                                }
                            });
                        }


                        //alert(window.location.hash);
                        //top.location.hash = 1;
                        //parent.location.hash = 1;
                        //window.location.hash = 1;
                        //location.hash = 1; // equals window.location.hash
                        //alert(location.pathname)


                        /*
                         * URL HASHES
                         * do not require a page refresh
                         */
                        function changeHash(offset = 1) {         // parameter is set to 1 by default if not specified (not required)
                            var x = +location.hash.substring(1); // get the hash and remove the # symbol, the leading '+' casts the string to an integer
                            if (isNaN(x)) {
                                return location.hash = 1;        // if the hash is not a number, set the hash to 1 and exit the function
                            }
                            location.hash = x + offset;          // move to the new hash in accordance with the offset
                        }










                        /*
                         * QUERY STRING JS
                         */
                        //            function getId() {
                        //                return new URL(window.location).searchParams.get("id");
                        //            }
                        //
                        //            function changeId(offset = 0) {              // default paremeter value, to avoid NaN output
                        //                var url = new URL(window.location);
                        //                var id = +url.searchParams.get("id");  // id is a string, leading '+' casts string to integer
                        //                url.searchParams.set("id", id + offset);
                        //                return url.href;
                        //            }



                        //                if (id === undefined && !!getId) { // .get("id") returns null if no id is present, !! casts null to false
                        //
                        //                }








                        /*
                         * XML JQUERY
                         */
                        //            var title;
                        //            var description;
                        //            var image;
                        //            var video;

                        //            /*
                        //             * function xml()
                        //             * Imports the xml document and allows to pass it as parameter to any function.
                        //             */
                        //            function xml(path, functionPassedAsParameter, tag, selector) {
                        //                $.ajax({// see specification on https://api.jquery.com/jquery.ajax/
                        //                    url: path,
                        //                    success: function (xml) {
                        //                        functionPassedAsParameter(xml, tag, selector);
                        //                    }
                        //                });
                        //            }
                        //            /*
                        //             * function loadData() is a xml parsing function.
                        //             * Populates the selected container with the xml element relative to the movie id.
                        //             */
                        //            function loadData(xml, tag, selector) {
                        //                var id = location.hash.substring(1);
                        //                var content = $(xml).find(tag).eq(id - 1).text(); // .eq() is a 0-based index
                        //                $(selector).html(content); // replaces content
                        ////                $(selector).append(content); // adds to the present content
                        //            }
                    </script>
                    </body>
                    </html>
